---
title: Query Tuning
headerTitle: Query Tuning
linkTitle: Query tuning
description: Tuning and optimizing query performance
headcontent: Optimize query performance
aliases:
menu:
  preview:
    identifier: query-tuning
    parent: explore
    weight: 300
type: indexpage
showRightNav: true
---

YugabyteDB provides a number of familiar performance tuning tools you can use to tune queries.

## Find slow queries

Use the `pg_stat_statements` extension to get statistics on past queries. Using `pg_stat_statements`, you can investigate queries by userid and dbid, calls, rows, and min, max, mean, standard deviation and total time.

The `pg_stat_statements` extension module is installed by default, but must be enabled for a database before you can query the `pg_stat_statements` view.

```sql
CREATE EXTENSION if not exists pg_stat_statements;
```

To get the output of `pg_stat_statements` in JSON format, visit `https://<yb-tserver-ip>:13000/statements` in your web browser, where `<yb-tserver-ip>` is the IP address of any YB-TServer node in your cluster.

{{<lead link="./pg-stat-statements/">}}
Learn how to get query statistics using [pg_stat_statements](./pg-stat-statements/).
{{</lead>}}

<!-- ### View live queries

Use the `pg_stat_activity` view to get information on currently running tasks. Using `pg_stat_activity` you can identify inactive, active, and long time active sessions, and get process information and the current query.

To get the output of `pg_stat_activity` in JSON format, visit `https://<yb-tserver-ip>:13000/rpcz` in your web browser, where `<yb-tserver-ip>` is the IP address of any YB-TServer node in your cluster.

For more information, refer to [View live queries with pg_stat_activity](../observability/pg-stat-activity/).

### View COPY operation status

Use the `pg_stat_progress_copy` view to get status information of a COPY command execution. In addition to the COPY status, `pg_stat_progress_copy` provides the number of tuples processed and other additional information, and retains the COPY progress report after the command execution.

For more information, refer to [View COPY progress with pg_stat_progress_copy](../observability/pg-stat-progress-copy/). -->

## View plans with EXPLAIN

Like PostgreSQL, YugabyteDB provides the `EXPLAIN` statement to show the query execution plan generated by YSQL for a given SQL statement. Using `EXPLAIN`, you can discover where in the query plan the query is spending most of its time, and using this information, decide on the best approach for improving query performance. This could include strategies such as adding an index or changing index sort order.

{{<lead link="./explain-analyze/">}}
Learn about [analyzing queries with EXPLAIN](./explain-analyze/).
{{</lead>}}

## Advanced tools

Use the following tools to log slow-running queries and optimize queries using hint plans.

### Log slow queries

You can set the `--ysql_log_min_duration_statement` flag to help track down slow queries. When configured, YugabyteDB logs the duration of each completed SQL statement that runs the specified duration (in milliseconds) or longer. (Setting the value to 0 prints all statement durations.)

```sh
$ ./bin/yb-tserver --ysql_log_min_duration_statement 1000
```

Example log output:

```output
2021-05-26 21:13:49.701 EDT [73005] LOG:  duration: 34.378 ms  statement: SELECT c.oid,
        n.nspname,
        c.relname
    FROM pg_catalog.pg_class c
        LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
    WHERE c.relname OPERATOR(pg_catalog.~) '^(products)$'
        AND pg_catalog.pg_table_is_visible(c.oid)
    ORDER BY 2, 3;
```

Results are written to the current `postgres*log` file.

{{< note title="Note" >}}

Depending on the database and the work being performed, long-running queries don't necessarily need to be optimized.

Ensure that the threshold is high enough so that you don't flood the `postgres*log` log files.

{{< /note >}}

{{<lead link="/preview/troubleshoot/nodes/check-logs/#yb-tserver-logs">}}
Learn more about [YB-TServer logs](/preview/troubleshoot/nodes/check-logs/#yb-tserver-logs).
{{</lead>}}

{{<lead link="../../reference/configuration/yb-tserver/#ysql">}}
Learn more about [YSQL flags](../../reference/configuration/yb-tserver/#ysql) for configuring YB-TServer.
{{</lead>}}

### Use a hint plan

YugabyteDB uses the PostgreSQL `pg_hint_plan` extension to control query execution plans with hints.

`pg_hint_plan` makes it possible to influence the query planner using so-called "hints", which are C-style comments that use a special syntax.

{{< note title="Note" >}}

To use `pg_hint_plan` effectively, you need a thorough knowledge of how your application will be deployed. Hint plans also need to be revisited when the database grows or the deployment changes to ensure that the plan is not limiting performance rather than optimizing it.

{{< /note >}}

{{<lead link="./pg-hint-plan/">}}
To learn more, see [Optimizing YSQL queries using pg_hint_plan](./pg-hint-plan/).
{{</lead>}}

&nbsp;

{{<index/block>}}

  {{<index/item
    title="Introduction"
    body="Tune and optimize query performance in YugabyteDB."
    href="query-tuning-intro/"
    icon="fa-thin fa-engine">}}

  {{<index/item
    title="Get query statistics"
    body="Track planning and execution statistics for all SQL statements executed by a server using pg_stat_statements and ycql_stat_statements."
    href="pg-stat-statements/"
    icon="fa-thin fa-chart-simple">}}

  {{<index/item
    title="Analyze queries with EXPLAIN"
    body="Tune your queries by creating and analyzing execution plans."
    href="explain-analyze/"
    icon="fa-thin fa-microscope">}}

  {{<index/item
    title="Optimize YSQL queries using pg_hint_plan"
    body="Control query execution plans with hinting phrases."
    href="pg-hint-plan/"
    icon="fa-thin fa-gauge-simple-max">}}

{{</index/block>}}
